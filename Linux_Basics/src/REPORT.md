# Операционные системы UNIX/Linux (Базовый).

Установка и обновления системы Linux. Основы администрирования.



## Part 1. Установка ОС

**== Задание ==**

##### Установи **Ubuntu 24.04 Server LTS** без графического интерфейса. (Используем программу для виртуализации - VirtualBox)

- Графический интерфейс должен отсутствовать.

- Узнай версию Ubuntu, выполнив команду \
`cat /etc/issue`
- Вставь скриншот с выводом команды.
---
**== Решение ==**  
![ubuntu version](part1_ubuntu_version.png)
## Part 2. Создание пользователя

**== Задание ==**

##### Создай пользователя, отличного от созданного при установке. Пользователь должен быть добавлен в группу `adm`.

- Вставь скриншот вызова команды для создания пользователя.
- Новый пользователь должен быть в выводе команды \
`cat /etc/passwd`
- Вставь скриншот с выводом команды.
---
**== Решение ==**  
![sudo useradd](part2_n1.png)
![sudo passwd bob](part2_n2.png)
![sudo mkdir /home/bob](part2_n3.png)
![sudo usermod bob -s /bin/bash](part2_n4.png)
![sudo usermod bob -s /bin/bash](part2_n6.png)
![cat /etc/passwd](part2_n5.png)

## Part 3. Настройка сети ОС

**== Задание ==**

##### Задай название машины вида user-1.

**== Решение ==**  
![hostname](part3_hostname.png)
___
**== Задание ==**
##### Установи временную зону, соответствующую твоему текущему местоположению.  
**== Решение ==**

![timezone](part3_timezone.png)
___
**== Задание ==**
##### Выведи названия сетевых интерфейсов с помощью консольной команды.
- В отчёте дай объяснение наличию интерфейса lo.

**== Решение ==**  
![ip a](part3_n1.png)  
lo (loopback device) – виртуальный интерфейс, присутствующий по умолчанию в любом Linux. Он используется для отладки сетевых программ и запуска серверных приложений на локальной машине. С этим интерфейсом всегда связан адрес 127.0.0.1. У него есть dns-имя – localhost.
___
**== Задание ==**
##### Используя консольную команду, получи ip адрес устройства, на котором ты работаешь, от DHCP сервера. 
- В отчёте дай расшифровку DHCP.

**== Решение ==**  
![ip a](part3_n1.png)  
10.0.2.15/24  
DHCP — протокол прикладного уровня модели TCP/IP, служит для назначения IP-адреса клиенту. Это следует из его названия — Dynamic Host Configuration Protocol. IP-адрес можно назначать вручную каждому клиенту, то есть компьютеру в локальной сети. Но в больших сетях это очень трудозатратно, к тому же, чем больше локальная сеть, тем выше возрастает вероятность ошибки при настройке. Поэтому для автоматизации назначения IP был создан протокол DHCP. 
___
**== Задание ==**
##### Определи и выведи на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw). 

**== Решение ==**  
Внешний  
![ip](part3_ip.png)  
Gateway  
![gateway](part3_gw.png)  
___
**== Задание ==**
##### Задай статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (используй публичный DNS серверы, например 1.1.1.1 или 8.8.8.8).

**== Решение ==**  
sudo vim /etc/netplan/50-cloud-init.yaml  
![static ip,gw,dns](part3_static.png)  
netplan apply  
reboot
___
**== Задание ==**  
##### Перезагрузи виртуальную машину. Убедись, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте.  



- Успешно пропингуй удаленные хосты 1.1.1.1 и ya.ru и вставь в отчёт скрин с выводом команды. В выводе команды должна быть фраза «0% packet loss».  
 
**== Решение ==**  
![ping](part3_ping.png)

___
## Part 4. Обновление ОС


**== Задание ==**  

##### Обнови системные пакеты до последней на момент выполнения задания версии.  

- После обновления системных пакетов, если ввести команду обновления повторно, должно появиться сообщение, что обновления отсутствуют;
- Вставь скриншот с этим сообщением в отчёт.
---
**== Решение ==**  
![upgrade && update](part4.png)

## Part 5. Использование команды **sudo**
**== Задание ==**
##### Разреши пользователю, созданному в [Part 2](#part-2-создание-пользователя),выполнять команду sudo.

- В отчёте объясни *истинное* назначение команды sudo (про то, что это слово - «волшебное», писать не стоит);  
- Поменяй hostname ОС от имени пользователя, созданного в пункте [Part 2](#part-2-создание-пользователя) (используя sudo);
- Вставь скрин с изменённым hostname в отчёт.  
---
**== Решение ==**  
Команда sudo может использоваться для выполнения пользователем какой-либо команды, требующей права суперпользователя (root), то есть получение прав root для выполнения какой-либо команды на время её выполнения. Перед выполнением команды sudo запрашивает пароль пользователя, а не пароль root.  
![sudo for bob](part5_v1.png)  
![hostname](part5_v2.png)  
![view from max](part5_v3.png)  
___
## Part 6. Установка и настройка службы времени

**== Задание ==**  

##### Настрой службу автоматической синхронизации времени.  

- Выведи время часового пояса, в котором ты сейчас находишься.
- Вывод следующей команды должен содержать `NTPSynchronized=yes`: \
  `timedatectl show`
- Вставь скрины с корректным временем и выводом команды в отчёт.
---
**== Решение ==**  
![current time](part_6.png) 

## Part 7. Установка и использование текстовых редакторов 
**== Задание ==**  

##### Установи текстовые редакторы **VIM** (+ любые два по желанию **NANO**, **MCEDIT**, **JOE** и т.д.)  
##### Используя каждый из трех выбранных редакторов, создай файл *test_X.txt*, где X -- название редактора, в котором создан файл. Напиши в нём свой никнейм, закрой файл с сохранением изменений.  
- В отчёт вставь скриншоты:
  - Из каждого редактора с содержимым файла перед закрытием;
- В отчёте укажи, что сделал для выхода с сохранением изменений.
___
**== Решение ==**  
#### vim  
![vim](part7_vim_save.png)  
Выход с сохранением: "esc" + ввод ":wq" + "enter"
#### nano  
![nano](part7_nano_save.png)  
Выход с сохранением: ^O + "enter", ^X
#### joe  
![joe](part7_joe_save.png)  
Выход с сохранением: Ctrl + K + X
___
##### Используя каждый из трех выбранных редакторов, открой файл на редактирование, отредактируй файл, заменив никнейм на строку «21 School 21», закрой файл без сохранения изменений.
- В отчёт вставь скриншоты:
    - Из каждого редактора с содержимым файла после редактирования;
- В отчёте укажи, что сделал для выхода без сохранения изменений.  

**== Решение ==**  
#### vim
![vim](part7_vim_nsave1.png)  
Выход без сохранения: "esc" + ввод :q! + "enter"  
![vim](part7_vim_nsave2.png)  

#### nano
![nano](part7_nano_nsave1.png)  
Выход без сохранения: ^X + "N"  
![nano](part7_nano_nsave2.png)  

#### joe
![joe](part7_joe_nsave1.png)  
Выход без сохранения: Ctrl + K + Q  
![joe](part7_joe_nsave2.png)  
___
##### Используя каждый из трех выбранных редакторов, отредактируй файл ещё раз (по аналогии с предыдущим пунктом), а затем освой функции поиска по содержимому файла (слово) и замены слова на любое другое.
- В отчёт вставь скриншоты:
    - Из каждого редактора с результатами поиска слова;
    - Из каждого редактора с командами, введёнными для замены слова на другое.

**== Решение ==**  
#### vim
![vim](part7_vim_search.png)  
Найти слово "world":  
\:/\\<world\\>  

![vim](part7_vim_replace.png)  
Заменить слово "Hello" на "Goodbye":  
:%s/\\<Hello\\>/Goodbye/g  

#### nano
![nano](part7_nano_search.png)  
Найти слово "world":  
^w

![nano](part7_nano_replace.png)  
Заменить слово "Hello" на "Goodbye":  
^\ + ввести слово 1 + ввести слово 2 + "Y"

#### joe
![joe](part7_joe_search.png) 
Найти слово "world":  
"Ctrl" + "K" + "F"

![joe](part7_joe_replace.png) 
Заменить слово "Hello" на "Goodbye":  
"Ctrl" + "K" + "F" + слово 1 + ввести "r" + слово 2 + "Y" + "I" (если не в Insert)

## Part 8. Установка и базовая настройка сервиса **SSHD**

`-` Удобно иметь доступ от одного компьютера к другому по сети, правда? Но чтобы это было не только удобно, но и безопасно, стоит использовать сервис SSH.

**== Задание ==**

##### Установи службу SSHd.  
##### Добавь автостарт службы при загрузке системы.  
##### Перенастрой службу SSHd на порт 2022.  
##### Используя команду ps, покажи наличие процесса sshd. Для этого к команде нужно подобрать ключи.
- В отчёте объясни значение команды и каждого ключа в ней.
##### Перезагрузи систему.
- В отчёте опиши, что сделал для выполнения всех пяти пунктов (можно как текстом, так и скриншотами).
- Вывод команды netstat -tan должен содержать  \
`tcp 0 0 0.0.0.0:2022 0.0.0.0:* LISTEN`  \
(если команды netstat нет, то ее нужно установить)
- Скрин с выводом команды вставь в отчёт.
- В отчёте объясни значение ключей -tan, значение каждого столбца вывода, значение 0.0.0.0.
___
**== Решение ==**  
sudo apt update  
sudo apt install openssh-server  
sudo systemctl enable ssh  
sudo vim /etc/ssh/sshd_config  
![Port 2022](part8_port.png)  
sudo systemctl restart ssh  
#### ps aux | grep sshd  
___ps___ — отображает текущие процессы.  
___a___ — показывает процессы, принадлежащие другим пользователям, а не только текущему.  
___u___ — отображает процессы с дополнительной информацией о пользователях, которым они принадлежат.  
___x___ — показывает процессы без управляющего терминала (это полезно для демоноподобных процессов, таких как sshd).  
___|___ — это пайплайн, который позволяет передавать вывод одной команды в качестве ввода другой команды.  
___grep sshd___ — фильтрует вывод, показывая только строки, содержащие "sshd". 
![ps aux | grep sshd](part8_ps.png)   
#### После перезагрузки 
#### netstat -tan
___t___ - Выводит только TCP cоединения.  
___a___ - Показывает как слушающие, так и не слушающие (для TCP это означает установленные соединения).  
___n___ - Показывает числовые адреса вместо попыток определить символьные имена хостов, портов или пользователей.  

![netstat -tan](part8_netstat.png)  
_Proto (Protocol)_:
    Протокол соединения. В данном случае это tcp. 

_Recv-Q (Receive Queue)_:
    Размер очереди полученных данных для данного сокета. Значение 0 означает, что в данный момент нет непрочитанных данных.

_Send-Q (Send Queue)_:
    Размер очереди отправленных данных для данного сокета. Значение 0 означает, что в данный момент нет данных, ожидающих отправки.

_Local Address (Локальный адрес)_:
    Локальный IP-адрес и порт, к которым привязан данный сокет. В данном случае это :::2022.

_Foreign Address (Удаленный адрес)_:
    Удаленный IP-адрес и порт, к которым подключен данный сокет. В данном случае это ::\:*, что означает, что сокет готов принимать соединения с любого удаленного адреса на любом порту.

_State (Состояние)_:
    Текущее состояние сокета. В данном случае это LISTEN, что означает, что сокет находится в состоянии прослушивания и готов принимать входящие соединения.  





## Part 9. Установка и использование утилит **top**, **htop**

**== Задание ==**

##### Установи и запусти утилиты top и htop.  

- По выводу команды top определи и напиши в отчёте:
  - uptime
  - количество авторизованных пользователей
  - общую загрузку системы
  - общее количество процессов
  - загрузку cpu
  - загрузку памяти
  - pid процесса занимающего больше всего памяти
  - pid процесса, занимающего больше всего процессорного времени
- В отчёт вставь скрин с выводом команды htop:
  - отсортированному по PID, PERCENT_CPU, PERCENT_MEM, TIME
  - отфильтрованному для процесса sshd
  - с процессом syslog, найденным, используя поиск 
  - с добавленным выводом hostname, clock и uptime  
___
**== Решение ==**  
#### top
  - uptime - 1:53
  - количество авторизованных пользователей - 1
  - общую загрузку системы - 0.00, 0.02, 0.00
  - общее количество процессов - 108
  - загрузку cpu ≈ 0.2% - 0.5%, где процессы ядра ≈ 0.2%, программные прерывани ≈ 0.2%
  - загрузку памяти - RAM загружена на 311 МБ, подкачка на 0.0
  - pid процесса занимающего больше всего памяти - 1385
  - pid процесса, занимающего больше всего процессорного времени - 2004
#### htop
### PID sort
![pid sort](part9_htop_pid.png) 

### CPU sort
![cpu sort](part9_htop_cpu.png)  

### MEM sort
![pid](part9_htop_mem.png)  

### TIME sort
![pid](part9_htop_time.png)  

### SSHD filtered
![sshd filter](part9_htop_sshd.png)  

### syslog search
![syslog search](part9_htop_syslog.png)  

### Additional output
![syslog search](part9_htop_output.png)  

## Part 10. Использование утилиты **fdisk**

**== Задание ==**
##### Запусти команду fdisk -l.

- В отчёте напиши название жесткого диска, его размер и количество секторов, а также размер swap.  
___
**== Решение ==**  
![fdisk -l](fdiskl.png)  
Название: /dev/sda     
Размер: 25 ГБ  
52428800 секторов    
2ГБ размер swap (видно в free -h и swapon --show)   


## Part 11. Использование утилиты **df** 

**== Задание ==**

##### Запусти команду df.  
- В отчёте напиши для корневого раздела (/):
  - размер раздела
  - размер занятого пространства
  - размер свободного пространства
  - процент использования
- Определи и напиши в отчёт единицу измерения в выводе.  

**== Решение ==**  
#### df (/)
![df](df.png)  
Размер раздела: 25623780 КБ  
Размер занятого пространства: 5373340 КБ  
Размер свободного пространства: 18923492 КБ  
Процент использования: 23%  
___
**== Задание ==**
##### Запусти команду df -Th.
- В отчёте напиши для корневого раздела (/):
    - размер раздела
    - размер занятого пространства
    - размер свободного пространства
    - процент использования
- Определи и напиши в отчёт тип файловой системы для раздела.

**== Решение ==**  
![df -Th](dfth.png)  
Размер раздела: 25 ГБ  
Размер занятого пространства: 5.2 ГБ  
Размер свободного пространства: 19 ГБ  
Процент использования: 23%  
Тип файловой системы раздела: ext4
___
## Part 12. Использование утилиты **du**

`-` df - не единственный способ получить информацию о дисковом пространстве. Сейчас расскажу про ещё один.

**== Задание ==**

##### Запусти команду du
##### Выведи размер папок /home, /var, /var/log (в байтах, в человекочитаемом виде)
##### Выведи размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *)

- В отчёт вставь скрины с выводом всех использованных команд.  

**== Решение ==**  
![du](du1.png)
![du](du2.png)
![du](du3.png)

## Part 13. Установка и использование утилиты **ncdu**

`-` Тебе, возможно, не очень понравился формат, в котором команда du выводит информацию. Я тебя прекрасно понимаю. Поэтому сейчас мы рассмотрим её улучшенную версию.

**== Задание ==**

##### Установи утилиту ncdu
##### Выведи размер папок /home, /var, /var/log

- Размеры должны примерно совпадать с полученными в [Part 12](#part-12-использование-утилиты-du).

- В отчёт вставь скрины с выводом использованных команд.  

**== Решение ==**  
![ncdu](ncdu1.png)
![ncdu](ncdu2.png)
![ncdu](ncdu3.png)

## Part 14. Работа с системными журналами

`-` Системному администратору иногда приходится просматривать события, происходившие в системе в недавнем прошлом. Для этого в Linux есть системные журналы.

**== Задание ==**

##### Открой для просмотра:
##### 1. /var/log/dmesg
##### 2. /var/log/syslog
##### 3. /var/log/auth.log  

- Напиши в отчёте время последней успешной авторизации, имя пользователя и метод входа в систему;
- Перезапусти службу SSHd;
- Вставь в отчёт скрин с сообщением о рестарте службы (искать в логах).

**== Решение ==**
#### dmesg
![dmesg](log1.png)
#### syslogs
![syslogs](log2.png)
#### auth.log
![auth.log](log3.png)  
![auth.log](auth.png)
Время последней успешной авторизации: 7.08.2024 04:09:57  
Пользователь: max  
Метод входа в систему: login  
#### ssh logs
![auth.log](ssh_logs.png)


## Part 15. Использование планировщика заданий **CRON**
**== Задание ==**

##### Используя планировщик заданий, запусти команду uptime через каждые 2 минуты.
- Найди в системных журналах строчки (минимум две в заданном временном диапазоне) о выполнении;
- Выведи на экран список текущих заданий для CRON;
- Вставь в отчёт скрины со строчками о выполнении и списком текущих задач.

##### Удали все задания из планировщика заданий.
- В отчёт вставь скрин со списком текущих заданий для CRON.  

**== Решение ==**
#### CRON - добавление задачи
![cron](crontab.png)
#### CRON logs
![cron logs](cron_log.png)
#### CRON - текущие задачи
![cron current tasks](cron_l.png)
#### CRON - удаление задач
![cron delete tasks](cron_r.png)


